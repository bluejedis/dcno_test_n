<div style="float: left; width: 64%; padding: 1%;">

### 在局域网上进行硬件多播

<ul>

#### 多播地址映射过程

<ul>

- 因为局域网支持硬件多播，thus只要把IP多播地址映射成多播MAC地址
- 即可将IP多播数据报封装在局域网的MAC帧中
- MAC顿首部的目的MAC地址字段就设置为由IP多播地址映射成的多播MAC地址

</ul>

#### 以太网多播地址范围

<ul>

- IANA拥有的以太网多播地址的范围是从01-00-5E-00-00-00到01-00-5E-7F-FF-FF
- 在这些地址中：
  - 只有23位可用作多播
  - 这只能和D类IP地址中的23位有一一对应关系
  - D类IP地址可供分配的有28位，可见在这28位中前5位无法映射到多播MAC地址，如图4.21所示

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/990325a354dd6d4421e60646b9cd97567ed23139bd25859486d30625de05571f.jpg)
图4.21D类IP地址与以太网多播地址的映射关系

</ul>

#### 地址映射示例与过滤

<ul>

- IP多播地址224.128.64.32（即E0-80-40-20）和另一个IP多播地址224.0.64.32（即E0-00-40-20）转换成以太网的硬件多播地址都是01-00-5E-00-40-20
- 因为多播IP地址与以太网MAC地址的映射关系不是唯一的，thus收到多播数据报的主机，还要在IP层利用软件进行过滤，把不是本主机要接收的数据报丢弃

</ul>

</ul>

</ul>

### IGMP与多播路由协议

<ul>

#### IGMP概述

<ul>

- 路由器要获得多播组的成员信息，需要利用网际组管理协议（InternetGroupManagementProtocol，IGMP)
- 连接到局域网上的多播路由器还必须和互联网上的其他多播路由器协同工作
  - 以便把多播数据报用最小代价传送给所有组成员
  - 这就需要使用多播路由选择协议

</ul>

#### IGMP特点

<ul>

- IGMP是让连接到本地局域网上的多播路由器，知道本局域网上是否有主机参加或退出了某个多播组
- IGMP并不是在互联网范围内对所有多播组成员进行管理的协议
- IGMP不知道：
  - IP多播组包含的成员数
  - 这些成员分布在哪些网络上

</ul>

#### IGMP工作机制

<ul>

- IGMP报文被封装在IP数据报中传送，但它也向IP提供服务
- thus不把IGMP视为一个单独的协议，而视为整个网际协议IP的一个组成部分
- IGMP的工作可分为两个阶段：

##### 第一阶段

<ul>

- 当某台主机加入新的多播组时：
  - 该主机应向多播组的多播地址发送一个IGMIP报文，声明自己要成为该组的成员
  - 本地的多播路由器收到IGIMP报文后，还要利用多播路由选择协议，把这种组成员关系转发给互联网上的其他多播路由器

</ul>

##### 第二阶段

<ul>

- 组成员关系是动态的
- 本地多播路由器要周期性地探询本地局域网上的主机，以便知道这些主机是否仍继续是组的成员
- 只要对某个组有一台主机响应，多播路由器就认为这个组是活跃的
- 但一个组在经过几次探询后仍然没有一台主机响应：
  - 多播路由器就认为本网络上的主机都已离开了这个组
  - thus就不再把这个组的成员关系转发给其他的多播路由器

</ul>

</ul>

#### 多播路由选择

<ul>

- 多播路由选择实际上就是要找出以源主机为根结点的多播转发树
  - 其中每个分组在每条链路上只传送一次
  - 即在多播转发树上的路由器不会收到重复的多播数据报
- 不同的多播组对应于不同的多播转发树
- 同一个多播组，对不同的源点也会有不同的多播转发树

</ul>

</ul>

</ul>


</div>
<div style="float: right; width: 26%; padding: 1%;">

</div>
<div style="clear: both;"></div>
