<div style="float: left; width: 64%; padding: 1%;">

### 划分子网subnetting & 路由聚合Route aggregation

<ul>

#### 划分子网subnetting

<ul>

- 两级IP地址的缺点：
  - IP地址空间的利用率有时很低
  - 给每个物理网络分配一个网络号会使路由表变得太大，进而使网络性能变坏
  - 两级IP地址不够灵活

- 从1985年起，在IP地址中又增加了一个"子网号字段"，使两级IP地址变成了<span style="border-bottom: 2px solid black;">三级</span>IP地址
  - 这种做法称为<span style="border: 1px solid black; padding: 5px; display: inline-block;">划分子网</span>
  - 划分子网已成为互联网的正式标准协议

</ul>

##### subnetting的基本思路

<ul>

- subnetting is 一个单位内部的事情
  - **对外**still**表现为** **没有划分**子网的一个网络
  - 方法:
    - **从**网络的**主机号** **借用**若干位作为子网号~（主机号也相应减少了相同的位数）~
- 三级IP地址的结构：
  - <span style="border: 1px solid black; padding: 5px; display: inline-block;">IP地址： $=$ {<网络号>，<子网号>，<主机号>}</span>
- 路由器转发分组根据： IPDG的**目的网络号**
  - 本单位的路由器收到TP数据报后，再按目的网络号和子网号找到目的子网
  - 最后把IP数据报交付给目的主机

</ul>

#####  eg 

<ul>

- 将一个C类网络208.115.21.0划分为4个子网
  - 子网号占用2位，thus主机号就只有6位
  - 各子网的网络地址分别为208.115.21.0、208.115.21.64、208.115.21.128、208.115.21.192
  - 每个子网可分配的IP地址数为 $2^{6}{-}2{=}62$

> **attention:**

- subnetting只是把IP地址的**主机号部分**进行**再划分**
  - **不改变**IP地址**原**来**的网络号**
  - **从**一个**IP地址本身** **无法判断**该主机所连接的网络**whether**进行了subnetting
- subnet中的**主机号** **全0**或**全1**的地址不能被指派
  - 全0: 网络地址
  - 全1: 广播地址
- 划分子网**增加**了**灵活性**
  - but**减少了**能够连接在**network上**的**主机总数**

</ul>

</ul>

#### 子网掩码Subnet mask &默认网关Default Gateway

<ul>

##### 子网掩码

<ul>

- **==指明==** 分类IP地址的主机号部分 **==被借用==了** **多少位**作为子网号
*short as **SM** personally
> **pro：根据IP地址和子网掩码求网络地址（2022）**

- 组成：
  - 一个与IP地址相对应的、长32位的**二进制串**
    - 由一串1和跟随的一串0组成
    - 1对应于IP地址中的网络号及子网号
    - 0对应于主机号
- 主机或路由器只需将IP地址和其对应的子网掩码逐位"与"（AND运算），就可得出相应子网的网络地址

</ul>

##### 默认网关Default Gateway

<ul>

> **pro：默认网关配置错误对访问局域网和跨网访问的影响（2015）**

> **pro：默认网关和子网掩码的配置分析（2016、2019、2022）**

- 默认网关是**子网**与**外部网络**==连接==的设备
  - 也就是连接本机或子网的 **路由器接口**的'**IP地址**
- 主机发送数据时的process：
  - On the basis of所发送数据的目的IP地址，through子网掩码来判定目的**主机whether在子网中**
    - 若目的主机在子网中，则直接发送
    - 若目的主机不在子网中，则将该数据 → 默认网关，由网关（路由器）将其转发到其他网络

</ul>

##### 子网掩码使用规定

<ul>

- 现在的互联网标准规定：所有网络都must使用子网掩码
  - 若一个网络**未划分子网**，则该网络的**SM**use **Default**SM
  <span style="border: 1px solid black; padding: 5px; display: inline-block;">A、B、C类地址的DSM
    - 255.0.0.0、255.255.0.0、255.255.255.0</span>
- eg：
  - 某主机的1P地址为192.168.5.56，子网掩码为255.255.255.0
    - 进行逐位"与"运算后，得出该主机所在子网的网络号为192.168.5.0

</ul>

##### SM的重要性

<ul>

- is一个网络的重要属性
  - 路由器相互之间**交换路由信息**时，必须将自己**所在网络**的**子网掩码**告诉对方
  - 分组转发时：
    - 路由器将分组的目标地址和某网络的子网掩码**按位相与**
      - 若**结果**与该网络地址**一致**，则路由匹配成功
      - 路由器将**分组转发**至该网络

</ul>

##### SM使用要求

<ul>

- 一台主机在设置IP地址信息的同时，must设置**SM**
- 同属于一个子网的所有主机及路由器的相应端口，必须设置**相同**的SM
- 路由器的**路由表**中所包含的信息**主要内容**
  - 目的网络地址、**SM**、下一跳地址
---
</ul>

</ul>

####  <span style="color: silver;">无分类编址CIDR <span style="font-size: 14px;"> (无分类 域间 路由选择Classless Inter-Domain Routing</span> ——New

<ul>

##### CIDR基本概念

<ul>

- **消除**传统**A、B、C类地址**及**划分子网**的概念
- 特点：
  - **更有效**地分配IPv4的地址空间
  - 使用网络**前缀** **N**etwork **P**refix的概念代替网络的概念
    - 位数不固定，可以任意选取
- ==记法==：<span style="border: 1px solid black; padding: 5px; display: inline-block;">IP地址 = {<网络前缀>，<主机号>}</span>

</ul>

##### ?CIDR斜线记法

<ul>

- 记为："IP地址/网络前缀**所占的位数**"
  - NP 所占的位数corresponds to网络号的部分
  - ⇔ SM中连续1的部分
- eg：(128.14.32.5/20)
  - 掩码是20个连续的1和后续12个连续的0
  - IP=10000000.00001110.00100000.00000101
  - 掩码=11111111.11111111.11110000.00000000
  - 网络前缀=10000000.00001110.00100000.00000000(128.14.32.0)
![image](https://bluejedis.github.io/picx-images-hosting/image.8l042v31fg.webp)

</ul>

##### CIDR地址块address block特性

<ul>

> **pro：CIDR地址块的分析（2011、2015、2016、2019、2023）**
> **pro：地址块的最小地址和最大地址分析（2023）**

- 将网络前缀都相同的连续IP地址--compose-->一个CIDR地址块
- 地址范围：
  - 最小地址：10000000.00001110.00100000.00000000（128.14.32.0）
  - 最大地址：10000000.00001110.00101111.11111111（128.14.47.255）
![image](https://bluejedis.github.io/picx-images-hosting/image.3k81bawtmn.webp)
- 主机号全0或全1的地址一般不使用

</ul>

##### CIDR与子网的关系

<ul>

- CIDR although不use子网，still use<span style="border: 1px solid black; padding: 5px; display: inline-block;">掩码</span>
- CIDR不使用子网的含义：
  - 不在32位地址中**指明**若干位作为子网字段
- **单位内部**仍可划分子网：
  - 分配到地址块/20的单位可划分为8个子网
  - 从主机号中借用3位来划分子网
  - 每个子网的网络前缀变成23位

> **pro：子网广播地址/网络地址的分析（2011、2012、2018、2019）**

</ul>

##### CIDR地址块特点

<ul>

- 地址数量：
  - 地址块中的地址数一定是2的整数次幂
  - 实际可指派的地址数通常为2^N-2（N表示主机号的位数）
  - 主机号全0代表网络号，主机号全1为广播地址
- 网络前缀特性：
  - 网络前缀越短，其地址块包含的地址数就越多
  - 在三级结构的IP地址中，划分子网使网络前缀变长

</ul>

</ul>

#### 路由聚合Route aggregation

<ul>

- 一个CIDR地址块中有很多地址 
  - →  路由表中   **利用**CIDR**地址块**来查找目的网络
- 这种**地址**的**聚合**称为路由聚合，也称**构成超网**
  - 它使得路由表中的<span style="border-bottom: 2px solid black;">一个</span>项自可以表示<span style="border: 1px solid black; padding: 5px; display: inline-block;">多个</span>原来传统分类地址的路由
  - 有利于减少路由器之间的信息交换，进而提高网络性能

> **pro：路由聚合的分析（2009、2011、2013、2014、2018）**

</ul>

##### 示例

<ul>

- 在如图4.9所示的网络中，若不使用路由聚合
  - 则R1的路由表中need分别have到网络1和网络2的路由表项
- 不难发现
  - 网络1和网络2的网络前缀在二进制表示的情况下
    - 前16位都是相同的
    - 第17位分别是0和1
  - 从R1到网络1和网络2的路由的下一跳皆为R2
- 若<span style="border-bottom: 2px solid black;">使用路由聚合</span>
  - 则在R1看来，网络1和网络2可以构成一个更大的地址块206.1.0.0/16
  - 到网络1和网络2的两条路由就可聚合成一条到206.1.0.0/16的路由

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/3c327d3febd0959034937d5135371eb34698ee1d81aeb0c0a097b58a53585744.jpg)图4.9路由聚合的例子

> **pro：路由器分组转发的最长前缀匹配（2013、2015）**



##### 最长前缀匹配Longest prefix matching

<ul>

- 又称最佳匹配Optimal matching
- 使用CIDR时
  - 路由表中的个项由"网络前缀"和"下一跳地址"组成
  - 在查找路由表时可能会得到不止一个匹配结果
  - 此时，应当从匹配结果中选择具有<span style="border: 1px solid black; padding: 5px; display: inline-block;">最长网络前缀</span>的路由
    - 网络前缀越长，其地址块就越小
    - thus路由就越具体

</ul>

##### CIDR查找路由表的方法

<ul>

- 为了更有效地查找最长前缀匹配
  - 通常将无分类编址的路由表存放在一种层次式数据结构（通常采用<span style="border-bottom: 3px dotted black;">二叉线索</span>）中
  - 然后自上而下地按层次进行查找

</ul>

##### CIDR的优点

<ul>

- 网络前缀长度的**灵活性**
  - 因为上层网络的前缀长度较短，thus 相应的路由表的项目较少
  - 而内部又可采用延长网络前缀的方法来灵活地划分子网

</ul>

</ul>

#### 子网划分subnetting的application

<ul>

##### 子网划分方法Types of subnet division methods

<ul>

<span style="border: 1px solid black; padding: 5px; display: inline-block;">

  - 采用定长的SM
  - ..变..
</span>

</ul>

###### 定长SM划分 Fixed-length subnet mask division

<ul>

- 当采用定长的子网掩码划分子网时：
  - 所划分的每个子网使用相同的子网掩码
  - 每个子网所分配的IP地址数量也相同
  - thus容易造成地址资源的浪费

> **pro：采用定长SM划分子网的应用（2009、2010、2017、2018）**

</ul>

###### ..示例

<ul>

- 假设某单位拥有一个CIDR地址块为208.115.21.0/24：
  - 该单位有三个部门，各部门的主机台数分别为50、20、5
  - 采用定长的子网掩码给各部门分配IP地址
- 需求分析：
  - 部门1需要51个IP地址（含一个路由器接口地址）
  - 部门2需要21个IP地址
  - 部门3需要6个IP地址
- 划分方案：
  - 从给定地址块208.115.21.0/24的主机号部分借用2位作为子网号
  - 可以划分为 $2^{2}{=}4$ 个子网
  - 每个子网可分配的IP地址数为 $2^{8-2}{-}2!=!62$
- 具体划分：
  - 208.115.21.00000000～208.115.21.00111111，地址块"208.115.21.0/26"，分配给部门1
  - 208.115.21.01000000\~208.115.21.01111111，地址块"208.115.21.64/26"，分配给部门2
  - 208.115.21.10000000\~208.115.21.10111111，地址块"208.115.21.128/26"，分配给部门3
  - 208.115.21.11000000\~208.115.21.11111111，地址块"208.115.21.192/26"，留作以后用
  - 子网掩码：255.255.255.1100000，即255.255.255.192

</ul>

###### 变长SM划分Variable-length subnet mask division

<ul>

> **pro：采用变长SM划分子网的应用（2019、2021）**

- 特点：
  - 所划分的每个子网可以使用不同的子网掩码
  - 每个子网所分配的IP地址数量可以不同
  - 这样就尽可能地减少了对地址资源的浪费

</ul>

###### ..示例

<ul>

- 需求分析：
  - 部门1的主机号需6位，剩余26（ $(32-6=26$ ）位作为网络前缀
  - 部门2的主机号需5位，剩余27（ $(32-5=27)$ ）位作为网络前缀
  - 部门3的主机号需3位，剩余29 $(32-3=29$ ）位作为网络前缀
- 划分方案：
  - 从地址块 $208.115.21.0/24$ 中划分出3个子网
    - 1个"/26"地址块
    - 1个"727"地址块
    - 1个"/29"地址块
  - 按需分配给三个部门
  - 每个子网的最小地址只能选取主机号全0的地址
  - 建议从大的子网开始划分

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ac44667c05deef529ea237a5beaa962fc08414413a27f237c11d6473ec294d88.jpg)

- 注意事项：
  - 子网主机号全0或全1的地址不能分配
  - 对于一段连接两个路由器的链路：
    - 可以分配一个"730"地址块
    - 这样可分配地址为2个
    - 恰好可分配给链路两端的路由器接口

</ul>

</ul>

</ul>

</div>
<div style="float: right; width: 26%; padding: 1%;">

</div>
<div style="clear: both;"></div>
