<div style="float: left; width: 64%; padding: 1%;">

## UDP数据报  

<ul>

### UDP概述  

<ul>

#### 定义

<ul>

UDP（User Datagram Protocol，用户数据报协议）
- 互联网协议套件（TCP/IP）中的一种无连接的传输层协议
  - 无连接的、不可靠
- TCP提供面向连接的、可靠的数据传输服务

</ul>

#### UDP的基本功能

<ul>

- UDP仅在 IP层的数据报（网络层） 服务之上增加了两个最基本的功能：
  - 复用和分用
  - 差错检测

</ul>

#### UDP的优点选择

<ul>

- 为什么应用开发者宁愿在UDP之上构建应用，也不选择TCP？
- 既然TCP提供可靠的服务，而UDP不提供，则TCP总是首选吗？
  - 答案是否定的，因为有很多应用更适合用UDP

> pro：UDP协议的特点（2014）

</ul>

##### 主要优势

<ul>

- **无须**建立**连接**
  - 因此UDP不会引入建立连接的时延
    - 试想若DNS运行在TCP而非UDP上，则DNS的速度会慢很多
  - HTTP使用TCP而非UDP，是因为对于基于文本数据的Web网页来说，可靠性是至关重要的
- 无连接状态
  - TCP需要在端系统中维护连接状态
    - 此连接状态包括接收和发送缓存、拥塞控制参数和序号与确认号的参数
  - UDP既不维护连接状态，也不跟踪这些参数
  - 因此，当某些专用服务器使用UDP时，一般都能支持更多的活动客户机
- UDP的**首部开销小**
  - **TCP**有**20B**的首部开销，而UDP仅有8B的开销
- UDP **无拥塞控制**
  - 因此网络中的拥塞**不会影响**源主机的**发送速率**
  - 某些实时应用要求源主机以稳定的速率发送数据，能容忍一些数据的丢失，但不允许有太大的时延
- UDP支持**多种通信**方式
  - 一对一、一对多、多对一和多对多的交互通信

</ul>

#### UDP的应用场景

<ul>

- UDP常用于**一次性**传输**较少数据**的网络应用
  - 如DNS、SNMP等
  - 因为对于这些应用，若采用TCP，则将为连接创建、维护和拆除带来不小的开销
- UDP也常用于多媒体应用
  - 如IP电话、实时视频会议、流媒体等
  - 显然，可靠数据传输对这些应用来说并不是最重要的
  - TCP的拥塞控制会导致数据出现较大的延迟，这是它们不可容忍的

</ul>

#### UDP的可靠性与报文特性

<ul>

##### 可靠性处理

<ul>

- UDP不保证可靠交付，但这并不意味着应用对数据的要求是不可靠的
- 所有维护可靠性的工作可由用户在应用层来完成
- 应用开发者可根据应用的需求来灵活设计自己的可靠性机制

</ul>

##### 报文处理特性

<ul>

- UDP是面向报文的
  - 发送方处理：
    - UDP对应用层交下来的报文，在添加首部后就向下交付给IP层
    - 一次发送一个报文，既不合并，也不拆分，而是保留这些报文的边界
  - 接收方处理：
    - UDP对IP层交上来UDP数据报，在去除首部后就原封不动地交付给上层应用进程
    - **一次交付**一个完整的报文
- 报文大小选择
  - 报文**不可分割**，是UDP数据报处理的最小单位
  - 应用程序必须选择合适大小的报文
    - 若报文太长，UDP把它交给IP层后，可能会导致分片
    - 若报文太短，UDP把它交给IP层后，会使IP数据报的首部的相对长度太大
    - 两者都会降低IP层的效率

</ul>

</ul>

</ul>

### UDP的首部格式  

<ul>

#### 基本结构

<ul>

- UDP数据报包含两部分：
  - 首部字段
  - 用户数据字段
- UDP首部有8B，由4个字段组成
  - 每个字段的长度都是2B，如图5.2所示

> pro：UDP首部格式及各字段意义（2018）

</ul>

#### 字段说明

<ul>

- **源**端口
  - 源端口号
  - 在需要对方**回信时**选用，不需要时可用全0
- **目的**端口
  - 目的端口号
  - 这在终点**交付**报文时**必须使用**到

> pro： UDP首部的长度（2021)

- 长度
  - UDP数据报的长度（包括**首部**和**数据**）
  - 其**min值**是**8**（仅有首部）
- 检验和
  - 检测UDP数据报在传输中是否有错
  - 有错就丢弃
  - 该字段是可选的，当源主机不想计算检验和时，则直接令该字段为全0

- 当传输层从IP层收到UDP数据报时，就根据首部中的目的端口，把UDP数据报通过应的端口，上交最后的终点一一应用进程，如图5.3所示

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/da63d7c9b93503146918383294c5c15589fdbdc37358c5de93970ddb49063021.jpg)  
图5.2UDP数据报格式  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a16cc2056a05a15b10c395b7339bc3ac5fd58814468389f9a0015024fd2be756.jpg)  
图5.3UDP基于端口的分用  

</ul>

#### 端口处理

<ul>

- 若接收方UDP发现收到的报文中的自的**端口号不正确**（即不存在对应于端口号的应用进程）
  - 则就**丢弃**该报文
  - 并由**ICMP**发送"端口不可达"**差错报文**给发送方

</ul>

</ul>

</ul>

</div>
<div style="float: right; width: 26%; padding: 1%;">

</div>
<div style="clear: both;"></div>
