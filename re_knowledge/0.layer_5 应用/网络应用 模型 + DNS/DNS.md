<div style="float: left; width: 64%; padding: 1%;">
# 域名系统(**DNS**)  

<ul>

>pro：DNS向下依次使用的协议（2018、2021）  

<ul>

- 域名系统（Domain Name System，DNS）是因特网使用的命名系统
  - 用来把便于人们记忆的具有特定含义的主机名（如www.cskaoyan.com）转换为便于机器处理的IP地址
  - 相对于IP地址，人们更喜欢使用具有特定含义的字符串来标识因特网上的计算机
  - 值得注意的是，DNS系统采用客户/服务器模型
    - 其协议运行在UDP之上
    - 使用53号端口

- 从概念上可将DNS分为三部分
  - 层次域名空间
  - 域名服务器
  - 解析器

</ul>

## 层次域名空间  

<ul>

### 域名特点

<ul>

- 因特网采用层次树状结构的命名方法
  - 任何一个连接到因特网的主机或路由器，都有一个唯一的层次结构名称，即域名（DomainName）
  - 域（Domain）是名字空间中一个可被管理的划分
    - 域可以划分为子域，而子域还可以继续划分为子域的子域，形成顶级域、二级域、三级域等
    - 每个域名都由标号序列组成，而各标号之间用点（"."）隔开

- pic
  - ![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/335d7e57f36898e0a60c2df2cb3fd7fdafea1eee6aa0d4604bcebd67d4068da1.jpg)  
  图6.3一个域名的例子  

</ul>

### 域名标号规则

<ul>

- 标号中的英文不区分大小写
- 标号中除连字符（-）外不能使用其他的标点符号
- 每个标号不超过63个字符，多标号组成的完整域名最长不超过255个字符
- 级别最低的域名写在最左边，级别最高的顶级域名写在最右边

</ul>

### 顶级域名分类

<ul>

#### 国家（地区）顶级域名（nTLD）

<ul>

- 国家和某些地区的域名
  - ".cn"表示中国
  - "us"表示美国
  - "uk"表示英国

</ul>

#### 通用顶级域名（gTLD）

<ul>

- ".com"（公司）
- "net"（网络服务机构）
- "org"（非营利性组织）
- "edu"（教育机构）
- "gov"（国家或政府部门）

</ul>

#### 基础结构域名（arpa）

<ul>

- 用于反向域名解析，即IP地址反向解析为域名

</ul>
</ul>

### 域名管理

<ul>

- 各级域名由其上一级的域名管理机构管理
- 顶级域名由因特网名称与数字地址分配机构（ICANN）管理
- 国家顶级域名下注册的二级域名均由该国家自行确定
- 每个组织都可以将它的域再分成一定数目的子域，并将这些子域委托给其他组织去管理
- pic
  - ![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c7c571a79927f4b59ecf1e91a76adf8317ac05d76b12b5a344e3d21ebb103c82.jpg)  
  图6.4域名空间的树状结构  

</ul>
</ul>

## 域名服务器  

<ul>

### 基本概念

<ul>

- 域名到IP地址的解析是由运行在域名服务器上的程序完成的
- 一个服务器所负责管辖的范围称为区（小于或等于"域"）
  - 一个区中的所有结点必须是能够连通的
  - 每个区设置相应的权限域名服务器
- 域名服务器功能
  - 能够进行域名到IP地址的解析
  - 具有连向其他域名服务器的信息

</ul>

### 域名服务器<span style="color: green;">类型

<ul>

#### **根**域名服务器

<ul>

- 最高层次的域名服务器
- 知道所有顶级域名服务器的域名和IP地址
- 因特网上有13个根域名服务器
  - 每个"服务器"实际上是冗余服务器的集群
  - 用来管辖顶级域
  - 通常不直接转换域名为IP地址

</ul>

#### **顶级**域名服务器

<ul>

- 负责管理在该顶级域名服务器注册的所有二级域名
- 收到DNS查询请求时给出相应回答

</ul>

#### **权限**域名服务器（授权域名服务器）

<ul>

- 每台主机都必须在权限域名服务器处登记
- 一台主机最好至少有两个权限域名服务器
- 许多域名服务器同时充当本地域名服务器和权限域名服务器
- 总能将其管辖的主机名转换为该主机的IP地址

</ul>

#### **本地**域名服务器

<ul>

- 每个ISP或大学都可以拥有本地域名服务器
- 主机发出DNS查询请求时，请求报文发送给本地域名服务器
- Windows系统中配置"本地连接"时需填写DNS地址

</ul>
</ul>

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/5629d8bb8fb5177ee3e9a1ab880774ec6a90aeab599acde76f7da73da3ff2f16.jpg)  
图6.5DNS的层次结构  

</ul>

## 域名<span style="color: green;">解析</span>过程  

<ul>

>pro：**DNS**(域名系统) 协议的作用（2021)  

### 基本概念

<ul>

- 域名解析是指把域名转化为IP地址的过程
- 当客户端需要域名解析时，通过本机的DNS客户端构造一个DNS请求报文，以UDP数据报方式发往本地域名服务器

</ul>

### 查询方式

<ul>

域名解析有两种方式：递归查询和选代查询。

#### <span style="color: green;">递归</span>查询

<ul>

##### 主机 → 本地域名服务器

<ul>

- 若主机 所询问的本地域名服务器 → 不知道被查询域名的IP地址
  - 本地~ 以DNS客户的身份
    - 向**根**域名服务器继续发出查询请求报文（即替该主机继续查询）
  - 而不是 让该主机自己进行下一步的查询
- 两种查询方式的这一步是相同的

</ul>

>pro：递归查询DNS的工作原理（2010）  

##### 本地域名服务器 → 其他~ 的 <span style="color: green;">递归</span>查询

<ul>

- 本地域名服务器只需向根域名服务器查询一次
- 后面的几次查询都是递归地在其他几个域名服务器之间进行的［步骤 $\scriptstyle(\mathbf{\mathcal{B}}\sim\left(\mathbf{\mathcal{C}}\right)$ ]
- 在步骤 $\circleddash$ 中，本地域名服务器从根域名服务器得到了所需的ⅡP地址
- 最后在步骤 $^\mathrm{\textregistered}$ 中，本地域名服务器把查询结果告诉发起查询的主机
- 因为该方法给根域名服务器造成的负载过大，所以**实际**中**几乎不**使用

</ul>
</ul>

#### pic

<ul>

- ![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2663a99a9e96d72925ec8df3f3c96270b6c7942f0010e486c7694ed8830a3713.jpg)  
图6.6两种域名解析方式工作原理  
- unsertand:
  - 递归→顺次；迭代→有1个顺次，后面一步到位

</ul>

#### <span style="color: orange;">迭代</span>查询

<ul>

>pro：迭代查询DNS的工作原理（2016、2020）  

##### 本地域名服务器→其他~的 <span style="color: orange;">迭代</span>查询

<ul>

- 本地域名服务器 → 根域名~  <span style="color: gray;">的查询  通常是采用送代查询</span>
- 当根域名服务器收到本地域名服务器发出的选代查询请求报文时：
  - 要么给出所要查询的IⅡP地址
  - 要么告诉本地域名服务器："你下一步应当向哪个顶级域名服务器进行查询"
- 然后让本地域名服务器进行后续的查询（而不替本地域名服务器进行后续的查询）
- 顶级域名服务器收到查询报文后：
  - 要么给出所要查询的IP地址
  - 要么告诉本地域名服务器下一步应当向哪个权限域名服务器查询
- 最后，知道了所要解析的域名的IP地址后，把这个结果返回给发起查询的主机

</ul>
</ul>
</ul>

### 域名解析<span style="color: lightblue;">eg

<ul>

- 假定某客户机想获知域名为y.abc.com主机的IP地址，域名解析的过程
- （最多需要使用8个UDP报文：4个查询报文和4个回答报文）：  

  - 客户机向其本地域名服务器发出DNS请求报文（递归查询）
  - 本地域名服务器收到请求后
    - 查询本地缓存，若没有该记录
      - 则以DNS客户的身份向根域名服务器发出解析请求报文（迭代查询）
  - 根域名服务器收到请求后
    - 判断该域名属于.com域
      - 将对应的顶级域名服务器dns.com的IP地址返回给本地域名服务器
  - 本地域名服务器向顶级域名服务器dns.com发出解析请求报文（迭代查询）
  - 顶级域名服务器dns.com收到请求后
    - 判断该域名属于abc.com域
      - 因此将对应的权限域名服务器dns.abc.com的IP地址返回给本地域名服务器
  - 本地域名服务器向权限域名服务器dns.abc.com发起解析请求报文（迭代查询）
  - 权限域名服务器dns.abc.com收到请求后
    - 将查询结果返回给本地域名服务器
  - 本地域名服务器将查询结果保存到本地缓存
    - 同时返回给客户机

- ![image](https://bluejedis.github.io/picx-images-hosting/image.b8xncbpc0.webp)
  

  ```mermaid
  sequenceDiagram
      participant C as 客户机
      participant L as 本地域名服务器
      participant R as 根域名服务器
      participant T as 顶级域名服务器dns.com
      participant A as 权限域名服务器dns.abc.com

      C->>+L: 1.DNS请求报文(递归查询)
      L->>+R: 2.解析请求报文(迭代查询)
      R-->>-L: 3.返回顶级域名服务器dns.com的IP
      L->>+T: 4.解析请求报文(迭代查询)
      T-->>-L: 5.返回权限域名服务器dns.abc.com的IP
      L->>+A: 6.解析请求报文(迭代查询)
      A-->>-L: 7.返回查询结果
      L-->>-C: 8.返回查询结果

  ```

</ul>

### 高速缓存

<ul>

- store域名的相关映射信息<span style="color: gray;">(最近查询过的)
  - another**相同**的**域名查询**arrive
  - **直接**提供 **IP地址**

- details
  - 为了提高DINS的查询效率，并减少因特网上的DNS查询报文数量，在域名服务器中广泛地使用了高速缓存
  - 用来缓存最近查询过的域名的相关映射信息
  - 当另一个**相同**的**域名查询**到达该DNS服务器时，该服务器就能**直接**提供所要求的IP地址
  - 因为主机名和IP地址之间的映射不是永久的，所以DNS服务器将在**一段时间**后丢弃高速缓存中的信息
  - 在主机中同样也很需要高速缓存：
    - 许多主机在启动时从本地域名服务器下载域名和地址的全部数据库
    - 维护存放自己最近使用的域名的高速缓存
    - 只在从**缓存中找不到**域名时才使用域名服务器

</ul>
</ul>
</ul>
</div>
<div style="float: right; width: 26%; padding: 1%;">

</div>
<div style="clear: both;"></div>
