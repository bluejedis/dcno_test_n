<div style="float: left; width: 64%; padding: 1%;">

## <span style="color: DeepSkyBlue;">移动</span>IP

<ul>

### 概念

<ul>

- 指 
  - 移动站**以固定的IP地址**实现 <span style="color:green;">跨越</span> 不同网络的漫游功能，并保证基于IP的网络权限在漫游过程中**不发生任何改变**。
    - 目标：把分组自动地投递给移动站。
      - 一个移动站是把其连接点从一个网络或子网改变到另一个网络或子网的主机。
- 定义了**三种功能实体**：移动结点、本地代理（也称归属代理）和外地代理。
  - 1）移动结点
    - 具有永久IP地址的移动主机
  - 2）本地代理
    - 通常就是连接在归属网络（原始连接到的网络）上的路由器
  - 3）外地代理
    - 通常就是连接在被访网络（移动到另一地点所接入的网络）上的路由器
- 值得注意的是，某用户将笔记本关机后从家里带到办公室重新上网，在办公室能很方便地通过DHCP自动获取新的IP地址。
  - 虽然笔记本移动了，更换了地点及所接入的网络，但这并不是移动IP。
  - 但是，若我们需要在移动中进行TCP传输，则在移动站漫游时，应一直保持这个TCP连接，否则移动站的TCP连接就会断断续续。
  - 可见，若要使移动站在移动中的TCP连接不中断，就必须使笔记本的IP地址在移动中保持不变。
    - 这就是移动IP要研究的问题。

</ul>

</ul>

### 通信过程

<ul>

#### 通俗例子

<ul>

- 本科毕业时都将走向各自的工作岗位
  - 事先并不知道自己未来的准确通讯地址
  - 解决方案：彼此留下各自的家庭地址（即永久地址）
  - 毕业后若要和某同学联系
    - 只要写信寄到该同学的永久地址
    - 再请其家长把信件转交即可

</ul>

#### 基本概念

<ul>

- 每个移动站都有一个原始地址
  - 即永久地址（或归属地址）
  - 移动站原始连接的网络称为归属网络
  - 永久地址和归属网络的关联是不变的
- 在图4.22中
  - 移动站A的永久地址是131.8.6.7/16
  - 其归属网络是131.8.0.0/16
- 归属代理
  - 通常是连接到归属网络上的路由器
  - 代理功能是在应用层完成的
- 被访网络
  - 移动站移动到另一地点所接入的外地网络
  - 在图4.22中，移动站A被移动到被访网络15.0.0.0/8
- 外地代理
  - 通常是连接在被访网络上的路由器
  - 两个重要功能
    - 为移动站创建一个临时地址，称为转交地址
    - 及时把移动站的转交地址告诉其归属代理

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/4174d26dc508d9296f99faad8d6f94645b3e04daa497b46f1ac2b81540095c98.jpg)
图4.22移动IP的基本通信过程

> **attention:**

转交地址是供移动站、归属代理及外地代理使用的，各种应用程序都不会使用。外地代理要向连接在被访网络上的移动站发送IP分组时，直接使用移动站的MAC地址。

</ul>

#### 基本通信流程

<ul>

- 通信者B要和移动站A进行通信
  - B并不知道A在什么地方
  - B使用A的永久地址作为发送的IP分组中的目的地址
- 具体流程
  1. 移动站A在归属网络时，按传统的TCP/IP方式进行通信
  2. 移动站A漫游到被访网络时
     - 向外地代理进行登记，以获得一个临时的转交地址
     - 外地代理要向A的归属代理登记A的转交地址
  3. 归属代理知道移动站A的转交地址后
     - 会构建一条通向转交地址的隧道
     - 将截获的发送给A的IP分组进行再封装
     - 通过隧道发送给被访网络的外地代理
  4. 外地代理处理
     - 把收到的封装的IP分组进行拆封
     - 恢复成原始的IP分组
     - 发送给移动站A
  5. 移动站A在被访网络对外发送IP分组时
     - 仍然使用自己的永久地址作为IP分组的源地址
     - 无须通过A的归属代理来转发
     - 直接通过被访网络的外部代理
  6. 移动站A移动到另一被访网络时
     - 在新外地代理登记
     - 新外地代理将A的新转交地址告诉其归属代理
     - 无论如何移动，A收到的IP分组都是由归属代理转发的
  7. 移动站A回到归属网络时，A向归属代理注销转交地址

</ul>

#### 新增网络层功能

<ul>

- 移动站到外地代理的登记协议
- 外地代理到归属代理的登记协议
- 归属代理数据报封装协议
- 外地代理拆封协议

</ul>

</ul>

</ul>

</div>
<div style="float: right; width: 26%; padding: 1%;">

</div>
<div style="clear: both;"></div>
