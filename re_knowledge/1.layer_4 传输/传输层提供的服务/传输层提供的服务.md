<div style="float: left; width: 64%; padding: 1%;">

# 传输层提供的<span style="color: blue;">服务  

<ul>

## 传输层的功能  

<ul>

- 网络分层通信概述：
  - 数据链路层：提供链路上相邻节点之间的逻辑通信。
  - 网络层：提供主机之间的逻辑通信。
  - 传输层：为运行在不同主机上的进程之间提供逻辑通信。

- 传输层的定位：
  - 位于网络层之上、应用层之下。
  - 属于面向通信部分的最高层。
  - 也是用户功能中的最低层。

- 传输层的可靠性：
  - 即使网络层协议不可靠，传输层仍能为应用程序提供可靠服务。

- 传输层功能的存在：
  - 网络边缘的主机有传输层，用于端到端通信。
  - 路由器在转发分组时只用到下三层功能，不涉及传输层。

- 传输层的具体功能：
  - 见图5.1

</ul>

### 应用进程之间的逻辑通信  

<ul>

- 网络层与传输层的通信区别：
  - 网络层：
    - 通信的双方是两台主机，IP数据报首部包含这两台主机的IP地址。
  - 实际通信：
    - 两台主机中的应用进程之间的通信，称为端到端的逻辑通信。
  - IP协议：
    - 负责将分组送到目的主机，但分组仅停留在网络层，未交付给主机中的进程。
  - 传输层：
    - 通信的真正端点是主机中的进程。

</ul>

### 复用和分用  

<ul>

- 传输层的复用和分用：
  - 复用：发送方不同的应用进程可以使用同一个传输层协议传送数据。
  - 分用：**接收方**的传输层**剥去** 报文**首部**后，将数据正确交付到目的应用进程。
>attention
- 网络层的复用和分用：
  - 复用：发送方不同协议的数据都可以被封装成IP数据报发送。
  - 分用：接收方的网络层剥去首部后，将数据交付给相应的协议。

- 传输层逻辑通信示例：
  - ![传输层逻辑通信](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/63d78670549561819a300f6b9fc62e30df373cce7e510de756f34b967bc87bb0.jpg)
  - 图5.1展示了传输层为相互通信的进程提供逻辑通信。

</ul>

### 检错检测  

<ul>

- 传输层的差错检测：
  - 对收到的报文（**首部**和**数据**部分）进行差错检测。
  - TCP协议：
    - 接收方发现报文段出错，**要求**发送方**重发**该报文段。
  - UDP协议：
    - 接收方发现数据报出错，**直接丢弃**。

- **网络层**的限制：
  - IP数据报首部的检验和字段仅检验首部是否出错
  - **不检查** **数据部分**是否出错

</ul>

### 提供面向连接和无连接的传输协议  

<ul>

- 传输层的**作用**：
  - **屏蔽**低层网络核心的**细节**，如网络拓扑、路由协议等。
  - 为应用进程提供端到端的逻辑通信信道。
  - 逻辑通信信道的可靠性取决于传输层协议。

- 传输层协议与逻辑通信信道的关系：
  - 使用TCP协议时：
    - 网络不可靠，只提供尽最大努力服务。
    - 逻辑通信信道表现为全双工的可靠信道。
  - 使用UDP协议时：
    - 逻辑通信信道仍然是不可靠的。

- 网络层的限制：
  - 无法同时实现面向连接和无连接的协议。
  - 要么提供面向连接的服务，如虚电路。
  - 要么提供无连接服务，如数据报。

</ul>

## 传输层的寻址与<span style="color: blue;">端口  

<ul>

### 端口的作用  

<ul>

- 端口的作用：
  - 应用层进程通过端口将数据交付给传输层。
  - 传输层通过端口将报文段数据交付给应用层相应进程。
  - 端口在传输层的作用类似于IP地址在网络层的作用。
  - IP地址标识主机，而端口标识主机中的应用进程。

- 协议栈各层的服务访问点：
  - 数据链路层：帧的“类型”字段。
  - 网络层：IP数据报的“协议”字段。
  - 传输层：“端口号”字段。
  - 应用层：“用户界面”。

- 端口与硬件端口的区别：
  - 协议栈中的端口是软件端口。
  - 软件端口是应用层协议进程与传输实体交互的地址。
  - 硬件端口是不同硬件设备交互的接口。
  - 传输层使用软件端口。

</ul>

### ⚠️端口号  

<ul>

- 应用进程通过端口号进行标识：
  - 端口号长度为16比特，可表示65536个不同的端口号。
  - 端口号只具有本地意义，标识本计算机应用层中的各进程。
  - 不同计算机的相同端口号没有联系。

- 端口号的分类：
  - 服务器端使用的端口号：
    - **熟知**端口号：
      - 数值为**0**~**1**023，IANA指派给重要应用程序。
    - **登记**端口号：
      - 数值为**1**024~**4**9151，供无熟知端口号应用使用，需在IANA登记。
  - **客户**端使用的端口号：
    - 数值为**4**9152~**6**5535，动态选择，故称短暂端口号。
    - 服务器根据客户端报文中的端口号发送数据。
    - 通信结束后，短暂端口号可供其他客户进程使用。

- 常用的熟知端口号示例：
  - ![熟知端口号图片](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/e1544960964df4d9da3367ec224ca92c1bb3a1058ebde23539b5c5d0aa0c544a.jpg)
- 
  | 应用程序 | 端口号 |
  |---------|--------|
  | **FTP** | **21** |
  | SSH | 22 |
  | TELNET | 23 |
  | **SMTP** | **25** |
  | DNS | 53 |
  | HTTP | 80 |
  | **POP3** | **110** |
  | HTTPS | 443 |

</ul>

### 套接字Socket  

<ul>

- **网络标识**与**套接字**：
  <details>
  <summary>网络标识</summary>
  网络标识是机器在网络中的标志信息，它们使得网络设备能够被唯一识别和定位。在不同的网络层次中，有不同的标识类型：

    数据链路层：MAC地址 ← 设备在局域网（如以太网）中的  物理地址
    网络层：IP地址 ← 标识 主机或路由器
    传输层：端口号 ← 区分 同一台主机上的不同 网络服务
  </details>

  - IP地址： 标识和区别不同的**主机**
    - 端口号： 标识和区分一台主机中的不同**应用进程**
  - 套接字(**Socket**)=(**IP**地址：**端口号**)
    - 唯一标识网络中的一个应用进程
    - 用于**识别**网络通信中的**端点**
      - 唯一的通信端点

- **网络通信**中的套接字使用：
  - 主机A → 主机B的报文
    - 报文包含目的端口号和源端口号
    - 源端口号是“返回地址”的一部分
  - 主机A ← 主机B，会使用主机A报文中的源端口号作为目的端口号。
  - 完整的返回地址
    - 主机A的 IP地址和源端口号
 ```mermaid
    sequenceDiagram
    participant Host_A
    participant Host_B

    Note over Host_A,Host_B: Socket Communication
    
    Host_A->>Host_B: Message(Source Port, Destination Port)
    Note over Host_B: Records Source Port & IP
    
    Host_B->>Host_A: Reply(Using Host_A's Source Port as Destination)
    Note over Host_A,Host_B: Return Address = (Host_A IP : Source Port)
  ```

</ul>
</ul>

## 无连接服务与面向连接服务  

<ul>

### TCP/IP传输层协议概述

<ul>

- TCP/IP协议族在IP层之上使用了两个传输协议：
  - 面向连接的传输控制协议（TCP）
    - 采用TCP时，传输层向上提供的是一条全双工的可靠逻辑信道
  - 无连接的用户数据报协议（UDP）
    - 采用UDP时，传输层向上提供的是一条不可靠的逻辑信道

</ul>

### 传输层协议特点

<ul>

#### TCP特点与应用

<ul>

- TCP提供面向连接的可靠服务
  - 通信双方在传送数据之前必须先建立连接
  - 然后基于此连接进行可靠数据传输
  - 数据传输结束后要释放连接
  - TCP不提供广播或多播服务
- TCP为实现可靠数据传输的措施
  - 确认
  - 流量控制
  - 计时器
  - 连接管理等
- TCP的开销
  - 协议数据单元的首部增大很多
  - 要占用许多的处理机资源
- TCP的适用场合
  - 主要适用于可靠性更重要的场合，如：
    - 文件传输协议（FTP）
    - 超文本传输协议（HTTP）
    - 远程登录（TELNET）等

</ul>

#### UDP特点与应用

<ul>

- UDP提供无连接的不可靠服务
  - 通信双方在传送数据之前不需要建立连接
  - 接收方的传输层在收到UDP用户数据报后，无须给发送方发回任何确认
- UDP在IP层之上的附加服务
  - 多路复用
  - 对数据的错误检查
- UDP的优势
  - 比较简单
  - 执行速度比较快
  - 实时性好
- UDP的应用包括
  - 小文件传送协议（TFTP）
  - DNS
  - SNIMP
  - 实时传输协议（RTP）

表5.1所示为一些典型互联网应用所用的TCP/IP应用层协议和传输层协议。  

表5.1一些典型互联网应用所用的TCP/IP应用层协议和传输层协议
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/31e145544e04ef12547e4868bcdfac5ddf5c7a417aa2b6348a1ff3570218580d.jpg)  

> attention:

</ul>

</ul>

### 重要区别说明

<ul>

#### IP数据报和UDP数据报的区别

<ul>

- IP数据报
  - 在**网络层**要经过 **路由器** 的存储转发
- UDP数据报
  - 在**传输层**的**端到端**的逻辑信道中传输
  - **封装**成IP数据报在网络层传输时
    - UDP数据报的信息对路由器是不可见的

</ul>

#### TCP和网络层虚电路的区别

<ul>

- TCP报文段在传输层抽象的逻辑信道中传输，对路由器不可见
- 虚电路所经过的交换结点都必须保存虚电路状态信息
- 在网络层若采用虚电路方式，则无法提供无连接服务
- 而传输层采用TCP不影响网络层提供无连接服务

</ul>

</ul>

</ul>

</div>
<div style="float: right; width: 26%; padding: 1%;">

</div>
<div style="clear: both;"></div>
